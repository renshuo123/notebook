import{_ as s,o as a,c as n,S as l}from"./chunks/framework.b12503b9.js";const A=JSON.parse('{"title":"微信小程序优化指南","description":"","frontmatter":{},"headers":[],"relativePath":"1、学前端/5、小程序/小程序优化.md","filePath":"1、学前端/5、小程序/小程序优化.md"}'),p={name:"1、学前端/5、小程序/小程序优化.md"},o=l(`<h1 id="微信小程序优化指南" tabindex="-1">微信小程序优化指南 <a class="header-anchor" href="#微信小程序优化指南" aria-label="Permalink to &quot;微信小程序优化指南&quot;">​</a></h1><h2 id="关于微信小程序" tabindex="-1">关于微信小程序 <a class="header-anchor" href="#关于微信小程序" aria-label="Permalink to &quot;关于微信小程序&quot;">​</a></h2><blockquote><p>微信小程序上线至今已经大约已经有<code>5年</code>的时间，5年的时间，小程序的开发能力经过微信团队的不断努力优化，已经日益完善，不再像之前一样，翻翻文档就能完成一个简易的项目了，特别是性能优化方面，会优化与不会优化更是对产品的效果有着决定性的影响。</p></blockquote><h2 id="哪些部分需要优化" tabindex="-1">哪些部分需要优化？ <a class="header-anchor" href="#哪些部分需要优化" aria-label="Permalink to &quot;哪些部分需要优化？&quot;">​</a></h2><blockquote><ul><li>首页白屏现象</li><li>Loading加载时间过长，页面好久不显示</li><li>点击页面链接，页面跳转迟钝</li><li>按钮单击无响应</li><li>长内容列表，内容越多，越卡顿</li><li>......</li></ul></blockquote><p>有了优化的方向，就可以根据问题逐一诊断了</p><h2 id="小程序的启动流程" tabindex="-1">小程序的启动流程？ <a class="header-anchor" href="#小程序的启动流程" aria-label="Permalink to &quot;小程序的启动流程？&quot;">​</a></h2><h3 id="运行载体" tabindex="-1">运行载体 <a class="header-anchor" href="#运行载体" aria-label="Permalink to &quot;运行载体&quot;">​</a></h3><blockquote><ul><li>iOS、Mac</li><li>Android、PC</li><li>微信开发者工具</li></ul></blockquote><h3 id="环境准备" tabindex="-1">环境准备 <a class="header-anchor" href="#环境准备" aria-label="Permalink to &quot;环境准备&quot;">​</a></h3><blockquote><ul><li>小程序运行进程及运行环境准备</li><li>代码包下载、校验及初始化</li><li>视图层系统组件、WebView容器和原生组件的初始化</li><li>原生组件的初始化</li><li>逻辑层JS引擎初始化及域创建</li></ul></blockquote><h3 id="代码注入" tabindex="-1">代码注入 <a class="header-anchor" href="#代码注入" aria-label="Permalink to &quot;代码注入&quot;">​</a></h3><p>框架及第三方基础代码的初始化</p><blockquote><ul><li>小程序基础库注入</li><li>扩展库注入</li><li>插件、自定义组件注入</li></ul></blockquote><p>开发者代码注入</p><blockquote><ul><li>逻辑层代码「这里会派发<code>App.onLaunch</code>还有<code>App.onShow</code>这些事件」</li><li>视图层代码</li></ul></blockquote><h3 id="首屏渲染" tabindex="-1">首屏渲染 <a class="header-anchor" href="#首屏渲染" aria-label="Permalink to &quot;首屏渲染&quot;">​</a></h3><blockquote><ul><li>逻辑层页面初始化，这个时间点是<code>initDataSendTime</code>，会派发<code>Page.onLoad</code>事件</li><li>视图层时间点走到<code>viewLayerReaderStartTime</code>，会派发<code>Page.onShow</code>事件</li><li>开发者代码从后端拉取，准备data数据</li><li>页面渲染</li><li>视图层时间点走到<code>viewLayerReaderEndTime</code>，会派发<code>Page.onReady</code>事件，意味着首屏渲染完成</li></ul></blockquote><h3 id="启动方式" tabindex="-1">启动方式 <a class="header-anchor" href="#启动方式" aria-label="Permalink to &quot;启动方式&quot;">​</a></h3><h4 id="冷启动" tabindex="-1">冷启动 <a class="header-anchor" href="#冷启动" aria-label="Permalink to &quot;冷启动&quot;">​</a></h4><blockquote><p>小程序在用户设备上第一次打开或者是销毁之后再打开，或者是30分钟以后</p></blockquote><h4 id="热启动" tabindex="-1">热启动 <a class="header-anchor" href="#热启动" aria-label="Permalink to &quot;热启动&quot;">​</a></h4><blockquote><p>热启动是相对于冷启动而言的，热启动是小程序启动的一种优化机制，小程序进入后台30分钟以内再次进到前台，可以直接从后台状态然后回复到前台，所以，在这种情况下，刚刚那个<code>代码注入</code>、<code>首屏渲染</code>等基础工作就不会再执行了，设置<code>App.onLaunch</code>、<code>Page.onLoad</code>等这些一次性的生命周期，也不会有了。</p></blockquote><blockquote><p><strong>结论</strong> 由此，可以得出，要做小程序的性能优化，主要是做<code>冷启动</code>这块的优化以及运行时渲染性能的一个优化，小程序冷启动流程里涉及到一些程序和生命周期。</p></blockquote><h3 id="生命周期" tabindex="-1">生命周期 <a class="header-anchor" href="#生命周期" aria-label="Permalink to &quot;生命周期&quot;">​</a></h3><blockquote><p>在小程序中App和Page都有他们各自的生命周期函数。</p></blockquote><h4 id="app" tabindex="-1">App <a class="header-anchor" href="#app" aria-label="Permalink to &quot;App&quot;">​</a></h4><blockquote><ul><li>onLaunch，监听小程序初始化的事件</li><li>onShow 监听小程序启动或切前台的事件</li><li>onHide 监听小程序切后台的时间</li></ul></blockquote><h4 id="page" tabindex="-1">Page <a class="header-anchor" href="#page" aria-label="Permalink to &quot;Page&quot;">​</a></h4><blockquote><ul><li>onLoad 监听页面加载</li><li>onShow 监听页面显示</li><li>onReady 监听页面初次渲染完成</li><li>onHide 监听页面隐藏</li><li>onUnload 监听页面卸载</li></ul></blockquote><h2 id="优化技巧" tabindex="-1">优化技巧 <a class="header-anchor" href="#优化技巧" aria-label="Permalink to &quot;优化技巧&quot;">​</a></h2><h3 id="使用骨架屏" tabindex="-1">使用骨架屏 <a class="header-anchor" href="#使用骨架屏" aria-label="Permalink to &quot;使用骨架屏&quot;">​</a></h3><p>骨架屏的目的是为了减缓用户等待的情绪使用</p><p>如图，在小程序开发者工具中，点击这里，生成骨架屏代码</p><img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.1.30/202212221513873.png" alt="image-20221222151303596" style="zoom:50%;"><p>然后他会生成两个文件：<code>index.skeleton.wxml</code> &amp; <code>index.skeleton.wxss</code></p><p>分别在<code>index.wxml</code> &amp; <code>index.wxss</code>引入</p><img src="https://edu-8673.oss-cn-beijing.aliyuncs.com/img2023.1.30/202212221513604.png" alt="image-20221222151324430" style="zoom:50%;"><blockquote><ul><li><strong>在data数据对象中默认设置loading等于true。</strong></li><li><strong>不要直接修改生成的骨架屏的一个代码。通过配置去修改。</strong></li><li>**不要过度去使用骨架屏。一般只给主页去添加骨架屏效果 **</li></ul></blockquote><h3 id="优化长列表" tabindex="-1">优化长列表 <a class="header-anchor" href="#优化长列表" aria-label="Permalink to &quot;优化长列表&quot;">​</a></h3><p>优化长列表，使用<code>recycle-view</code> &amp; <code>recycle-item</code> 虚拟DOM组件，在渲染的时候需要知道每个循环单元的一个高度，这是消费代码需要传递给组件的，在recycle-view组件里面，用户滑动的是数据而不是组件本身。</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">使用\` 首先初始化\`package.json</span></span>
<span class="line"><span style="color:#A6ACCD;">// npm初始化package.json文件</span></span>
<span class="line"><span style="color:#A6ACCD;">npm init -y</span></span></code></pre></div><p>安装</p><div class="language-scss"><button title="Copy Code" class="copy"></button><span class="lang">scss</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// 安装 miniprogram-recycle-view插件</span></span>
<span class="line"><span style="color:#A6ACCD;">npm install --save miniprogram-recycle-view</span></span></code></pre></div><p>构建依赖 <img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b72b64e647134820936aa7d01970c68b~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?" alt="image.png"> 生成<code>miniprogram_npm</code>目录</p><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/09883c4389f642829c96b6216eebea85~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?" alt="image.png"></p><p>组件内引用</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/81d01220c33a42b2acdc754126ab9e0f~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?" alt="image.png"></p><p>代码中使用</p><p>list.wxml</p><div class="language-xml"><button title="Copy Code" class="copy"></button><span class="lang">xml</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">recycle-view</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">batch</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">{{batchSetRecycleData}}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">id</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">recycleId</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">catchscroll</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">onScroll</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">view</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">slot</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">before</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">长列表前面的内容</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">view</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">recycle-item</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">wx</span><span style="color:#89DDFF;">:</span><span style="color:#C792EA;">for</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">{{recycleList}}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">wx</span><span style="color:#89DDFF;">:</span><span style="color:#C792EA;">key</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">id</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">view</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">image</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">style</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">width:80px;height:80px;float:left;</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">src</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">{{item.image_url}}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;&lt;/</span><span style="color:#F07178;">image</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">      {{item.idx+1}}. {{item.title}}</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">view</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">recycle-item</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">view</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">slot</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">after</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">长列表后面的内容</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">view</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"><span style="color:#89DDFF;">&lt;/</span><span style="color:#F07178;">recycle-view</span><span style="color:#89DDFF;">&gt;</span></span></code></pre></div><p>list.js</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> createRecycleContext </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">miniprogram-recycle-view</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#82AAFF;">Page</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#82AAFF;">onReady</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">var</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">ctx</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">createRecycleContext</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      id</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">recycleId</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      dataKey</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">recycleList</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      page</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this,</span></span>
<span class="line"><span style="color:#F07178;">      itemSize</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">itemSizeFunc</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">ctx</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">append</span><span style="color:#F07178;">([</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      image_url</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">https://p1-juejin.byteimg.com/atermark.image?</span><span style="color:#89DDFF;">&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      idx</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      title</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">你好</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">])</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// ctx.update(beginIndex, list)</span></span>
<span class="line"><span style="color:#89DDFF;">    </span><span style="color:#676E95;font-style:italic;">// ctx.destroy()</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#F07178;">onScroll</span><span style="color:#89DDFF;">()</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">scroll</span><span style="color:#89DDFF;">&#39;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">},</span></span>
<span class="line"><span style="color:#A6ACCD;">  </span><span style="color:#82AAFF;">itemSizeFunc</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">item</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">idx</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">item</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">      width</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">375</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">      height</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">100</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">  </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span></code></pre></div><p>代码写起来不是那么舒服，组件使用不友好，但是对性能确实还不错。</p><h3 id="使用页面容器" tabindex="-1">使用页面容器 <a class="header-anchor" href="#使用页面容器" aria-label="Permalink to &quot;使用页面容器&quot;">​</a></h3><p>有时候我们在页面上会弹出一些特定的半屏窗口，例如登录窗口。这时候如果用户在iOS设备上使用了左滑手势或者是在Android设备上单击了物理返回键，会造成页面跳转到上一个页面，这在大多数情况下它并不是用户的真实本意，用户可能只是想将当前弹出的半屏的假页面给它关掉。</p><p><code>page-container</code>页面容器，是不需要引入便可以使用。</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">&lt;page-container :show=&quot;{{show}}&quot;&gt; </span></span>
<span class="line"><span style="color:#A6ACCD;">    ...</span></span>
<span class="line"><span style="color:#A6ACCD;">&lt;/page-container&gt;</span></span></code></pre></div><p>这个组件其实就是防止用户的<code>左滑</code>或者<code>按键返回</code>误操作，导致整个页面回退的问题。</p><h3 id="优化动画效果" tabindex="-1">优化动画效果 <a class="header-anchor" href="#优化动画效果" aria-label="Permalink to &quot;优化动画效果&quot;">​</a></h3><p>实现动画的方式：</p><ul><li>是使用Animation对象，实现CSS动画</li><li>使用页面或组件对象，拥有的animate方法实现的关键帧动画</li><li>使用滚动事件驱动的响应式动画</li><li>通过WXS脚本，实现了一个样式动画</li><li>通过第三方库实现<code>animate.css</code></li></ul><h3 id="代码按需注入" tabindex="-1">代码按需注入 <a class="header-anchor" href="#代码按需注入" aria-label="Permalink to &quot;代码按需注入&quot;">​</a></h3><p>代码懒加载</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">使用</span></span>
<span class="line"><span style="color:#A6ACCD;">// app.json</span></span>
<span class="line"><span style="color:#A6ACCD;">&quot;lazyCodeLoading&quot;: &quot;requiredComponents&quot;</span></span></code></pre></div><p>出现以下提示，代表成功</p><p><img src="https://p1-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/026d8fb75779455e920b615fd2cbbcca~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?" alt="image.png"></p><h3 id="静态初始化渲染缓存" tabindex="-1">静态初始化渲染缓存 <a class="header-anchor" href="#静态初始化渲染缓存" aria-label="Permalink to &quot;静态初始化渲染缓存&quot;">​</a></h3><p>第一次页面运行时，由微信客户端负责将页面在本地的某个区域缓存起来，下次在真正的页面未加载完成前，先展示这个缓存过的页面。</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">使用</span></span>
<span class="line"><span style="color:#A6ACCD;">// xxxx.json</span></span>
<span class="line"><span style="color:#A6ACCD;">&quot;initialRenderingCache&quot;: &quot;static&quot;</span></span></code></pre></div><h3 id="动态初始化渲染缓存" tabindex="-1">动态初始化渲染缓存 <a class="header-anchor" href="#动态初始化渲染缓存" aria-label="Permalink to &quot;动态初始化渲染缓存&quot;">​</a></h3><p>与静态初始化渲染缓存，动态初始化渲染缓存可以设置动态缓存的数据，放在<code>onReady</code>生命周期中</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">使用</span></span>
<span class="line"><span style="color:#A6ACCD;">// xxx.json</span></span>
<span class="line"><span style="color:#A6ACCD;">&quot;initialRenderingCache&quot;: &quot;dynamic&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">复制代码</span></span>
<span class="line"><span style="color:#A6ACCD;">// xxx.js</span></span>
<span class="line"><span style="color:#A6ACCD;">// 设置动态缓存数据</span></span>
<span class="line"><span style="color:#A6ACCD;">this.setInitialRenderingCache({</span></span>
<span class="line"><span style="color:#A6ACCD;">    customersList: customerList</span></span>
<span class="line"><span style="color:#A6ACCD;">})</span></span></code></pre></div><p>如果出现以下的信息，不用在意。</p><p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/818f4fd9c8c54056a727d60c952fd43b~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?" alt="image.png"></p><p>在手机里会有一条成功的信息：</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#F78C6C;">update</span><span style="color:#A6ACCD;"> view </span><span style="color:#F78C6C;">with</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">init</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">data</span></span></code></pre></div><h3 id="分包" tabindex="-1">分包 <a class="header-anchor" href="#分包" aria-label="Permalink to &quot;分包&quot;">​</a></h3><p>小程序包大小规定，单个代码包不超过2MB，总包大小不超过20MB，所以到我们业务庞大，代码量大导致项目大小上升，就必须用分包的形式，解决这个问题。</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">使用</span></span>
<span class="line"><span style="color:#A6ACCD;">// app.json</span></span>
<span class="line"><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    &quot;pages&quot;: [</span></span>
<span class="line"><span style="color:#A6ACCD;">        // &quot;pages/user/index&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">    ],</span></span>
<span class="line"><span style="color:#A6ACCD;">    &quot;subpackages&quot;: [</span></span>
<span class="line"><span style="color:#A6ACCD;">        {</span></span>
<span class="line"><span style="color:#A6ACCD;">            &quot;root&quot;: &quot;user&quot;,</span></span>
<span class="line"><span style="color:#A6ACCD;">            &quot;pages&quot;: [</span></span>
<span class="line"><span style="color:#A6ACCD;">                &quot;pages/user/index&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">            ]</span></span>
<span class="line"><span style="color:#A6ACCD;">        }</span></span>
<span class="line"><span style="color:#A6ACCD;">    ]</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span></code></pre></div><h3 id="独立分包" tabindex="-1">独立分包 <a class="header-anchor" href="#独立分包" aria-label="Permalink to &quot;独立分包&quot;">​</a></h3><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">使用</span></span>
<span class="line"><span style="color:#A6ACCD;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    &quot;pages&quot;: [</span></span>
<span class="line"><span style="color:#A6ACCD;">        // &quot;pages/user/index&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        // &quot;pages/goods/index&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">    ],</span></span>
<span class="line"><span style="color:#A6ACCD;">    &quot;subpackages&quot;: [</span></span>
<span class="line"><span style="color:#A6ACCD;">        {</span></span>
<span class="line"><span style="color:#A6ACCD;">            &quot;root&quot;: &quot;user&quot;,</span></span>
<span class="line"><span style="color:#A6ACCD;">            &quot;pages&quot;: [</span></span>
<span class="line"><span style="color:#A6ACCD;">                &quot;pages/user/index&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">            ]</span></span>
<span class="line"><span style="color:#A6ACCD;">        },</span></span>
<span class="line"><span style="color:#A6ACCD;">        {</span></span>
<span class="line"><span style="color:#A6ACCD;">            &quot;root&quot;: &quot;goods&quot;,</span></span>
<span class="line"><span style="color:#A6ACCD;">            &quot;pages&quot;: [</span></span>
<span class="line"><span style="color:#A6ACCD;">                &quot;pages/goods/index&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">            ],</span></span>
<span class="line"><span style="color:#A6ACCD;">            &quot;independent&quot;: true // 独立分包关键配置</span></span>
<span class="line"><span style="color:#A6ACCD;">        }</span></span>
<span class="line"><span style="color:#A6ACCD;">    ]</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">// pages/goods/index.js</span></span>
<span class="line"><span style="color:#A6ACCD;">const app = getApp({allowDefault: true}) // 独立分包中getApp为空，这里设置默认值</span></span></code></pre></div><p>独立分包之后访问独立分包页面，主包和组件是不会被加载的，所以要分实际业务场景，进行分包</p><h3 id="分包预加载" tabindex="-1">分包预加载 <a class="header-anchor" href="#分包预加载" aria-label="Permalink to &quot;分包预加载&quot;">​</a></h3><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">使用</span></span>
<span class="line"><span style="color:#A6ACCD;">&quot;preloadRule&quot;: {</span></span>
<span class="line"><span style="color:#A6ACCD;">// 分包root路径+后面的路径</span></span>
<span class="line"><span style="color:#A6ACCD;">    &quot;goods/pages/detail/index&quot;: {</span></span>
<span class="line"><span style="color:#A6ACCD;">        &quot;network&quot;: &quot;all&quot;,</span></span>
<span class="line"><span style="color:#A6ACCD;">        &quot;packages&quot;: [</span></span>
<span class="line"><span style="color:#A6ACCD;">            &quot;__APP__&quot;</span></span>
<span class="line"><span style="color:#A6ACCD;">        ]</span></span>
<span class="line"><span style="color:#A6ACCD;">    }</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span></code></pre></div><p>看到这个提示，表示成功</p><p><img src="https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/849fa956036d4e4c815be5af51cc1f60~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?" alt="image.png"></p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">总结</span></span></code></pre></div><ul><li>tabbar最好自己实现</li><li>所有在根目录下的文件，如果没有分包，都会打包进主包，所以一般情况下，只放一个首页进主包</li><li>分包配置需要指定一个<code>root</code>目录，该目录下所有的文件都会自动被分割到这个分包里</li><li>对于相对独立的页面（例如分享页），可以进行独立分包，独立分包的页面会有「返回首页的按钮」，一般队里分包里，都需要设置<code>分包预加载</code></li></ul><h3 id="使用占位组件" tabindex="-1">使用占位组件 <a class="header-anchor" href="#使用占位组件" aria-label="Permalink to &quot;使用占位组件&quot;">​</a></h3><p>使用占位组件延迟加载自定义组件</p><p><code>使用</code> 创建一个名称为<code>index_addons</code>的一个组件分包</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// app.json</span></span>
<span class="line"><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">subpackages</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">[</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">root</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">index_addons</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">pages</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">[]</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">]</span></span></code></pre></div><p>修改主页配置</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C792EA;">componentPlaceholder</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#89DDFF;">&quot;</span><span style="color:#FFCB6B;">stopwatch</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">view</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#676E95;font-style:italic;">// 欲用作占位组件</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>在stopwatch中添加代码</p><p><img src="https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/495e86c0eae0479989a362810da61860~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?" alt="image.png"></p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">调试</span></span></code></pre></div><ul><li>设置为2g网</li><li>本地设置里，设置<code>懒注入占位组件调试</code></li></ul><p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5b8807674da347d4b71909ec45098392~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?" alt="image.png"> 如果没有这个选项，请确认是否有配置 <code>&quot;lazyCodeLoading&quot;: [requiredComponents]</code></p><h3 id="分包异步化" tabindex="-1">分包异步化 <a class="header-anchor" href="#分包异步化" aria-label="Permalink to &quot;分包异步化&quot;">​</a></h3><ul><li>require</li><li>require.async 注意，只支持相对路径</li></ul><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">使用</span></span>
<span class="line"><span style="color:#A6ACCD;">const { default: getNavList } = await require.async(&quot;../../../index_addons/compopnents/get_nav_list.js&quot;)</span></span></code></pre></div><h3 id="视图代码优化技巧" tabindex="-1">视图代码优化技巧 <a class="header-anchor" href="#视图代码优化技巧" aria-label="Permalink to &quot;视图代码优化技巧&quot;">​</a></h3><h4 id="动态列表渲染里优化wx-key的使用" tabindex="-1">动态列表渲染里优化wx:key的使用 <a class="header-anchor" href="#动态列表渲染里优化wx-key的使用" aria-label="Permalink to &quot;动态列表渲染里优化wx:key的使用&quot;">​</a></h4><p>确保<code>wx:key</code>的值是唯一值</p><p>如果列表元素是单一的基本数据类型，并且是唯一的，这时候我们可以直接写成<em>this，这里这个</em>this，就代表当前数据列表里面的数据元素</p><div class="language-ini"><button title="Copy Code" class="copy"></button><span class="lang">ini</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">&lt;view wx:</span><span style="color:#F07178;">for</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">{{textList}}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> wx:</span><span style="color:#F07178;">key</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">*this</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">&gt;&lt;/view&gt;</span></span></code></pre></div><p>如果列表元素是静态的，只渲染一次，那么可以直接用index</p><div class="language-ini"><button title="Copy Code" class="copy"></button><span class="lang">ini</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">&lt;view wx:</span><span style="color:#F07178;">for</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">{{swipers}}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> wx:</span><span style="color:#F07178;">key</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">index</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">&gt;&lt;/view&gt;</span></span></code></pre></div><p>如果数据是从后台获取的，那么<code>wx:key</code>需要有一个唯一值</p><div class="language-ini"><button title="Copy Code" class="copy"></button><span class="lang">ini</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">&lt;view wx:</span><span style="color:#F07178;">for</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">{{customerList}}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> wx:</span><span style="color:#F07178;">key</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">{{index}}</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">&gt;&lt;/view&gt;</span></span></code></pre></div><h4 id="绑定视图事件" tabindex="-1">绑定视图事件 <a class="header-anchor" href="#绑定视图事件" aria-label="Permalink to &quot;绑定视图事件&quot;">​</a></h4><p>使用<code>catch</code>代替<code>bind</code>，减少<code>dataset</code>的数据运输量，因为我们在大多数情况下，我们的事件不需要冒泡，所以<code>bind</code>很浪费性能，<code>catch</code>是不会冒泡的，事件传递某些信息的时候，需要什么传什么，不要一刀切，图省事，传递一个很大的对象，如果需要整个对象，建议使用<code>index</code>进行传递</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#A6ACCD;">view class</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">submit-btn</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> catchbind</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">onViewDetail</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">data</span><span style="color:#89DDFF;">-</span><span style="color:#F78C6C;">index</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">index</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;</span><span style="color:#A6ACCD;">view detail</span><span style="color:#89DDFF;">&lt;/</span><span style="color:#A6ACCD;">view</span><span style="color:#89DDFF;">&gt;</span></span></code></pre></div><h4 id="防抖-节流" tabindex="-1">防抖&amp;节流 <a class="header-anchor" href="#防抖-节流" aria-label="Permalink to &quot;防抖&amp;节流&quot;">​</a></h4><h5 id="节流" tabindex="-1">节流 <a class="header-anchor" href="#节流" aria-label="Permalink to &quot;节流&quot;">​</a></h5><p>节流顾名思义就是控制某段JS代码的执行频率</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">throttle</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">method</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">wait</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">50</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">previous</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#F78C6C;">0</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(...</span><span style="color:#A6ACCD;font-style:italic;">agrs</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">context</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">now</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">new</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">Date</span><span style="color:#F07178;">()</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">getTime</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">now</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">-</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">previouts</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&gt;</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">wait</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#A6ACCD;">method</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">apply</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">context</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">args</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#A6ACCD;">previous</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">now</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">节流少许</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><h5 id="防抖" tabindex="-1">防抖 <a class="header-anchor" href="#防抖" aria-label="Permalink to &quot;防抖&quot;">​</a></h5><p>顾名思义就是防止抖动，避免把一次时间当做多次处理，敲击键盘就是一个经常都会遇到的防抖操作场景</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">function</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">debounce</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">func</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">wait</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">50</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#C792EA;">let</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">timer</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">null</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">function</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">(...</span><span style="color:#A6ACCD;font-style:italic;">args</span><span style="color:#89DDFF;">)</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#C792EA;">const</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">contest</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">this</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">timer</span><span style="color:#F07178;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#82AAFF;">clearTimeout</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">timer</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#A6ACCD;">console</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">log</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">防抖少许</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">timer</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">=</span><span style="color:#F07178;"> </span><span style="color:#82AAFF;">setTimeout</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">            </span><span style="color:#A6ACCD;">func</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">call</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">context</span><span style="color:#89DDFF;">,</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">...</span><span style="color:#A6ACCD;">args</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">},</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">wait</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><h5 id="组件中使用" tabindex="-1">组件中使用 <a class="header-anchor" href="#组件中使用" aria-label="Permalink to &quot;组件中使用&quot;">​</a></h5><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">default</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">debounce</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">..</span><span style="color:#89DDFF;">/</span><span style="color:#C3E88D;">..</span><span style="color:#89DDFF;">/</span><span style="color:#89DDFF;">../</span><span style="color:#A6ACCD;">library</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">optimus</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">debounce</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">js)</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span><span style="color:#F07178;">default</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;">throttle</span><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">..</span><span style="color:#89DDFF;">/</span><span style="color:#C3E88D;">..</span><span style="color:#89DDFF;">/</span><span style="color:#89DDFF;">../</span><span style="color:#A6ACCD;">library</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">optimus</span><span style="color:#89DDFF;">/</span><span style="color:#A6ACCD;">throttle</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">js)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">onScrolllToLower</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">throttle</span><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">e</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">...</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#FFCB6B;">onTapCustomerItem</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">debounce</span><span style="color:#A6ACCD;">(</span><span style="color:#C792EA;">function</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">e</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">..</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span></code></pre></div><h4 id="尽量少的使用重渲染和wxml标签" tabindex="-1">尽量少的使用重渲染和wxml标签 <a class="header-anchor" href="#尽量少的使用重渲染和wxml标签" aria-label="Permalink to &quot;尽量少的使用重渲染和wxml标签&quot;">​</a></h4><p>官方建议：</p><blockquote><p>总页面节点数少于1000个，节点树深度层级少于30层，子节点数不大于60个</p></blockquote><p>所以，在开发过程中，能用<code>&lt;text&gt;</code>，就不用<code>&lt;view&gt;</code>，能用<code>文本</code>，就不用<code>&lt;text&gt;</code>，对于循环列表中，能用<code>&lt;block&gt;</code>就不用<code>&lt;view&gt;</code></p><p><img src="https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ef954f7253514eb0bc8dac0e34a8c7a2~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp?" alt="image.png"></p><h3 id="wxss优化技巧" tabindex="-1">WXSS优化技巧 <a class="header-anchor" href="#wxss优化技巧" aria-label="Permalink to &quot;WXSS优化技巧&quot;">​</a></h3><h4 id="给滚动组件开启惯性滚动" tabindex="-1">给滚动组件开启惯性滚动 <a class="header-anchor" href="#给滚动组件开启惯性滚动" aria-label="Permalink to &quot;给滚动组件开启惯性滚动&quot;">​</a></h4><div class="language-css"><button title="Copy Code" class="copy"></button><span class="lang">css</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">-webkit-overflow-scrolling: touch;;</span></span></code></pre></div><h4 id="使用hover-class实现按钮的单击态" tabindex="-1">使用hover-class实现按钮的单击态 <a class="header-anchor" href="#使用hover-class实现按钮的单击态" aria-label="Permalink to &quot;使用hover-class实现按钮的单击态&quot;">​</a></h4><div class="language-html"><button title="Copy Code" class="copy"></button><span class="lang">html</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">&lt;</span><span style="color:#F07178;">button</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">class</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">submit-btn</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;"> </span><span style="color:#C792EA;">hover-class</span><span style="color:#89DDFF;">=</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">submit-btn__hover</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">&gt;&lt;/</span><span style="color:#F07178;">button</span><span style="color:#89DDFF;">&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#A6ACCD;">.submit-btn {</span></span>
<span class="line"><span style="color:#A6ACCD;">    ...</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span>
<span class="line"><span style="color:#A6ACCD;">.submit-btn__hover {</span></span>
<span class="line"><span style="color:#A6ACCD;">    ...</span></span>
<span class="line"><span style="color:#A6ACCD;">}</span></span></code></pre></div><h4 id="使用gulp工具删除无用的wxss样式代码" tabindex="-1">使用gulp工具删除无用的wxss样式代码 <a class="header-anchor" href="#使用gulp工具删除无用的wxss样式代码" aria-label="Permalink to &quot;使用gulp工具删除无用的wxss样式代码&quot;">​</a></h4><p>安装</p><div class="language-css"><button title="Copy Code" class="copy"></button><span class="lang">css</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">npm install gulp -g</span></span>
<span class="line"><span style="color:#A6ACCD;">npm install --save-dev gulp </span><span style="color:#FFCB6B;">gulp-cleanwxss</span></span></code></pre></div><p>配置 /tools/gulpfile.js</p><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> gulp </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">gulp</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> cleanwxss </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">gulp-cleanwxss</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 处理父目录下的样式文件，输出到当前目录下的dist</span></span>
<span class="line"><span style="color:#A6ACCD;">gulp</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">task</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">default</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">done</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">group</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">src</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">../minniprogram/index/pages/*/*.wxss</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">pipe</span><span style="color:#F07178;">(</span><span style="color:#82AAFF;">cleanwxss</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> log</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">))</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">pipe</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">gulp</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">dest</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./dist</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">))</span></span>
<span class="line"><span style="color:#F07178;">     </span><span style="color:#82AAFF;">done</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// 处理分包下的样式文件</span></span>
<span class="line"><span style="color:#A6ACCD;">gulp</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">task</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">goods</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">done</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">group</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">src</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">../minniprogram/goods/pages/*/*.wxss</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">pipe</span><span style="color:#F07178;">(</span><span style="color:#82AAFF;">cleanwxss</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> log</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#FF9CAC;">true</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">))</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">pipe</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">gulp</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">dest</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">./dist</span><span style="color:#89DDFF;">&quot;</span><span style="color:#F07178;">))</span></span>
<span class="line"><span style="color:#F07178;">     </span><span style="color:#82AAFF;">done</span><span style="color:#F07178;">()</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span></code></pre></div><p>执行</p><div class="language-arduino"><button title="Copy Code" class="copy"></button><span class="lang">arduino</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">gulp default</span></span>
<span class="line"><span style="color:#A6ACCD;">gulp goods</span></span></code></pre></div><p>CV</p><p>将生成出来的样式文件复制到对应目录即可</p><h3 id="ui交互优化技巧" tabindex="-1">UI交互优化技巧 <a class="header-anchor" href="#ui交互优化技巧" aria-label="Permalink to &quot;UI交互优化技巧&quot;">​</a></h3><h4 id="使用padding扩大可点击区域大小" tabindex="-1">使用padding扩大可点击区域大小 <a class="header-anchor" href="#使用padding扩大可点击区域大小" aria-label="Permalink to &quot;使用padding扩大可点击区域大小&quot;">​</a></h4><div class="language-css"><button title="Copy Code" class="copy"></button><span class="lang">css</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">submit-btn</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    ...</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#B2CCD6;">padding</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">10px</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><h4 id="使用伪元素扩大可点击区域大小" tabindex="-1">使用伪元素扩大可点击区域大小 <a class="header-anchor" href="#使用伪元素扩大可点击区域大小" aria-label="Permalink to &quot;使用伪元素扩大可点击区域大小&quot;">​</a></h4><div class="language-css"><button title="Copy Code" class="copy"></button><span class="lang">css</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">submit-btn</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#B2CCD6;">position</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> relative</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    ...</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">.</span><span style="color:#FFCB6B;">submit-btn</span><span style="color:#89DDFF;">::</span><span style="color:#C792EA;">after</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#B2CCD6;">content</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;&#39;</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    position: absolute</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#B2CCD6;">top</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">-20px</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#B2CCD6;">right</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">-20px</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#B2CCD6;">bottom</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">-20px</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#B2CCD6;">left</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">-20px</span><span style="color:#89DDFF;">;</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><h3 id="脚本优化技巧" tabindex="-1">脚本优化技巧 <a class="header-anchor" href="#脚本优化技巧" aria-label="Permalink to &quot;脚本优化技巧&quot;">​</a></h3><h4 id="清理定时器" tabindex="-1">清理定时器 <a class="header-anchor" href="#清理定时器" aria-label="Permalink to &quot;清理定时器&quot;">​</a></h4><div class="language-scss"><button title="Copy Code" class="copy"></button><span class="lang">scss</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">clearTimeout(timer1)</span></span></code></pre></div><h4 id="使用wx-onxxx全局绑定-有一个监听-必须有一个反监听" tabindex="-1">使用wx.onXxx全局绑定，有一个监听，必须有一个反监听 <a class="header-anchor" href="#使用wx-onxxx全局绑定-有一个监听-必须有一个反监听" aria-label="Permalink to &quot;使用wx.onXxx全局绑定，有一个监听，必须有一个反监听&quot;">​</a></h4><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// 及时释放本页范围内添加的全局监听器</span></span>
<span class="line"><span style="color:#82AAFF;">onLoad</span><span style="color:#A6ACCD;">() </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">wx</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">onThemeChange</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">themeChangeHandler</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#82AAFF;">onUnload</span><span style="color:#A6ACCD;">() </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">wx</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">offThemeChange</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">themeChangeHandler</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span></code></pre></div><p>模拟器测试需要在<code>app.json</code>中添加</p><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">darkMode</span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">: </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">true</span><span style="color:#89DDFF;">&quot;</span></span></code></pre></div><h4 id="小心使用全局对象-适当时机清理" tabindex="-1">小心使用全局对象，适当时机清理 <a class="header-anchor" href="#小心使用全局对象-适当时机清理" aria-label="Permalink to &quot;小心使用全局对象，适当时机清理&quot;">​</a></h4><h3 id="setdata调用优化" tabindex="-1">setData调用优化 <a class="header-anchor" href="#setdata调用优化" aria-label="Permalink to &quot;setData调用优化&quot;">​</a></h3><h4 id="不要多次分开调用setdata-尽量合并" tabindex="-1">不要多次分开调用setData，尽量合并 <a class="header-anchor" href="#不要多次分开调用setdata-尽量合并" aria-label="Permalink to &quot;不要多次分开调用setData，尽量合并&quot;">​</a></h4><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#676E95;font-style:italic;">// bad</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">data</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">gender </span><span style="color:#89DDFF;">===</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">1</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">setData</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        genderName</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">男</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">data</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">gender </span><span style="color:#89DDFF;">===</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">0</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">) </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">setData</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        genderName</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">女</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;font-style:italic;">else</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">setData</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        genderName</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">未知</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#89DDFF;">}</span></span>
<span class="line"></span>
<span class="line"><span style="color:#676E95;font-style:italic;">// good</span></span>
<span class="line"><span style="color:#C792EA;">let</span><span style="color:#A6ACCD;"> genderName </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">未知</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">data</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">gender </span><span style="color:#89DDFF;">===</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">1</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">) genderName </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">男</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">if</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">data</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">gender </span><span style="color:#89DDFF;">===</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">0</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">) genderName </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">女</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">setData</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    genderName</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span></code></pre></div><h4 id="不准备渲染的数据-不要放在data对象中" tabindex="-1">不准备渲染的数据，不要放在data对象中 <a class="header-anchor" href="#不准备渲染的数据-不要放在data对象中" aria-label="Permalink to &quot;不准备渲染的数据，不要放在data对象中&quot;">​</a></h4><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#82AAFF;">Page</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">allList</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> []</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">pageNum</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">1</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">pageSize</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#F78C6C;">10</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">data</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">        </span><span style="color:#F07178;">list</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> []</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#89DDFF;">}</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span></code></pre></div><h4 id="通过index局部更新列表数据" tabindex="-1">通过index局部更新列表数据 <a class="header-anchor" href="#通过index局部更新列表数据" aria-label="Permalink to &quot;通过index局部更新列表数据&quot;">​</a></h4><div class="language-js"><button title="Copy Code" class="copy"></button><span class="lang">js</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#89DDFF;">this.</span><span style="color:#82AAFF;">setData</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#A6ACCD;">    </span><span style="color:#F07178;">[</span><span style="color:#89DDFF;">this.</span><span style="color:#A6ACCD;">data</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">customerList</span><span style="color:#F07178;">[</span><span style="color:#A6ACCD;">index</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">title</span><span style="color:#F07178;">]</span><span style="color:#89DDFF;">:</span><span style="color:#A6ACCD;"> item</span><span style="color:#89DDFF;">.</span><span style="color:#A6ACCD;">title</span><span style="color:#89DDFF;">+=</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">---</span><span style="color:#89DDFF;">&#39;</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#A6ACCD;">)</span></span></code></pre></div><h3 id="网络请求优化技巧" tabindex="-1">网络请求优化技巧 <a class="header-anchor" href="#网络请求优化技巧" aria-label="Permalink to &quot;网络请求优化技巧&quot;">​</a></h3><h4 id="减少不必要的网络请求-使用本地缓存数据" tabindex="-1">减少不必要的网络请求，使用本地缓存数据 <a class="header-anchor" href="#减少不必要的网络请求-使用本地缓存数据" aria-label="Permalink to &quot;减少不必要的网络请求，使用本地缓存数据&quot;">​</a></h4><p>技术点：<code>Storage</code></p><h4 id="优化网络请求参数-提高网络请求效率" tabindex="-1">优化网络请求参数，提高网络请求效率 <a class="header-anchor" href="#优化网络请求参数-提高网络请求效率" aria-label="Permalink to &quot;优化网络请求参数，提高网络请求效率&quot;">​</a></h4><div class="language-vbnet"><button title="Copy Code" class="copy"></button><span class="lang">vbnet</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">enableCache: true,</span></span>
<span class="line"><span style="color:#A6ACCD;">enableHttp2: true,</span></span>
<span class="line"><span style="color:#A6ACCD;">enableQuic: true</span></span></code></pre></div><h4 id="优化网络请求的并发数-分优先级" tabindex="-1">优化网络请求的并发数，分优先级 <a class="header-anchor" href="#优化网络请求的并发数-分优先级" aria-label="Permalink to &quot;优化网络请求的并发数，分优先级&quot;">​</a></h4><div class="language-arduino"><button title="Copy Code" class="copy"></button><span class="lang">arduino</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#A6ACCD;">npm i priority-async-queue</span></span></code></pre></div><p>request.js</p><div class="language-javascript"><button title="Copy Code" class="copy"></button><span class="lang">javascript</span><pre class="shiki material-theme-palenight"><code><span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> PriorityAsyncQueue </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">require</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">&#39;</span><span style="color:#C3E88D;">priority-async-queue</span><span style="color:#89DDFF;">&#39;</span><span style="color:#A6ACCD;">)</span></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> queue </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#82AAFF;">PriorityAsyncQueue</span><span style="color:#A6ACCD;">(</span><span style="color:#F78C6C;">10</span><span style="color:#A6ACCD;">) </span><span style="color:#676E95;font-style:italic;">// default 10</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C792EA;">const</span><span style="color:#A6ACCD;"> low </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">low</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> normal </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">normal</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> mid </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">mid</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> high </span><span style="color:#89DDFF;">=</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;">high</span><span style="color:#89DDFF;">&quot;</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> &quot;urgent</span><span style="color:#89DDFF;">&quot;</span><span style="color:#C3E88D;"> = </span><span style="color:#89DDFF;">&quot;</span><span style="color:#A6ACCD;">urgent</span><span style="color:#89DDFF;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="color:#C3E88D;">export const priority = { low, normal, mid, high, urgent }</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;">....</span></span>
<span class="line"></span>
<span class="line"><span style="color:#89DDFF;font-style:italic;">return</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">new</span><span style="color:#A6ACCD;"> </span><span style="color:#FFCB6B;">Promise</span><span style="color:#A6ACCD;">(</span><span style="color:#89DDFF;">(</span><span style="color:#A6ACCD;font-style:italic;">resolve</span><span style="color:#89DDFF;">,</span><span style="color:#A6ACCD;"> </span><span style="color:#A6ACCD;font-style:italic;">reject</span><span style="color:#89DDFF;">)</span><span style="color:#A6ACCD;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#A6ACCD;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">    </span><span style="color:#A6ACCD;">queue</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">addTask</span><span style="color:#F07178;">(</span><span style="color:#89DDFF;">{</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">priority</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">}.</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">()</span><span style="color:#F07178;"> </span><span style="color:#C792EA;">=&gt;</span><span style="color:#F07178;"> </span><span style="color:#89DDFF;">{</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#A6ACCD;">wx</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">request</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">Object</span><span style="color:#89DDFF;">.</span><span style="color:#82AAFF;">assgin</span><span style="color:#F07178;">(</span><span style="color:#A6ACCD;">args</span><span style="color:#89DDFF;">,{</span></span>
<span class="line"><span style="color:#F07178;">            success</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">resolve</span><span style="color:#89DDFF;">,</span></span>
<span class="line"><span style="color:#F07178;">            fail</span><span style="color:#89DDFF;">:</span><span style="color:#F07178;"> </span><span style="color:#A6ACCD;">reject</span></span>
<span class="line"><span style="color:#F07178;">        </span><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span>
<span class="line"><span style="color:#F07178;">    })</span></span>
<span class="line"><span style="color:#89DDFF;">}</span><span style="color:#F07178;">)</span></span></code></pre></div><h3 id="图片优化技巧" tabindex="-1">图片优化技巧 <a class="header-anchor" href="#图片优化技巧" aria-label="Permalink to &quot;图片优化技巧&quot;">​</a></h3><h4 id="减少图片的请求次数" tabindex="-1">减少图片的请求次数 <a class="header-anchor" href="#减少图片的请求次数" aria-label="Permalink to &quot;减少图片的请求次数&quot;">​</a></h4><h4 id="压缩图片大小" tabindex="-1">压缩图片大小 <a class="header-anchor" href="#压缩图片大小" aria-label="Permalink to &quot;压缩图片大小&quot;">​</a></h4><h4 id="尽可能使用cdn图片或图片链接" tabindex="-1">尽可能使用CDN图片或图片链接 <a class="header-anchor" href="#尽可能使用cdn图片或图片链接" aria-label="Permalink to &quot;尽可能使用CDN图片或图片链接&quot;">​</a></h4><h4 id="尽可能使用webp格式图片" tabindex="-1">尽可能使用webp格式图片 <a class="header-anchor" href="#尽可能使用webp格式图片" aria-label="Permalink to &quot;尽可能使用webp格式图片&quot;">​</a></h4>`,177),e=[o];function t(c,r,y,D,F,i){return a(),n("div",null,e)}const d=s(p,[["render",t]]);export{A as __pageData,d as default};
